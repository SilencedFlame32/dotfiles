
meta:
  project: containerd

mount=source:
  bind: .
  path: /go/src/github.com/containerd/containerd

mount=gobin:
  bind: ./gobin
  path: /go/bin

image=builder:
  image: containerd-dev
  context: dobifiles/
  dockerfile: Dockerfile.build

job=binaries:
  use: builder
  interactive: true
  mounts: [source]
  command: make binaries
  artifact: bin/

job=shell:
  use: builder
  interactive: true
  mounts: [source, gobin]
  command: bash
  privileged: true

job=watch:
  use: builder
  interactive: true
  mounts: [source]
  command: script/watch
  env:
   - 'TESTFLAGS={env.TESTFLAGS:}'

job=lint:
  use: builder
  interactive: true
  mounts: [source, gobin]
  command: make check

alias=binary:
  tasks: [binaries]
